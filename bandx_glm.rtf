{\rtf1\ansi\ansicpg1252\cocoartf1671\cocoasubrtf600
{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\margl1440\margr1440\vieww28600\viewh18000\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs24 \cf0 #import paired-end bam files after they have been aligned (hisat2) and import gtf file generated from merging reads and genome (cuffmerge).\
\
data<-featureCounts(files=c("/Users/andersond/Desktop/bam/C1M.sam.bam","/Users/andersond/Desktop/bam/C2M.sam.bam","/Users/andersond/Desktop/bam/C3M.sam.bam","/Users/andersond/Desktop/bam/C5M.sam.bam","/Users/andersond/Desktop/bam/C6M.sam.bam","/Users/andersond/Desktop/bam/E1M.sam.bam","/Users/andersond/Desktop/bam/E3M.sam.bam","/Users/andersond/Desktop/bam/E4M.sam.bam","/Users/andersond/Desktop/bam/E5M.sam.bam","/Users/andersond/Desktop/bam/E6M.sam.bam","/Users/andersond/Desktop/bam/C1F.sam.bam","/Users/andersond/Desktop/bam/C2F.sam.bam","/Users/andersond/Desktop/bam/C3F.sam.bam","/Users/andersond/Desktop/bam/C4F.sam.bam","/Users/andersond/Desktop/bam/C5F.sam.bam","/Users/andersond/Desktop/bam/E1F.sam.bam","/Users/andersond/Desktop/bam/E2F.sam.bam","/Users/andersond/Desktop/bam/E3F.sam.bam","/Users/andersond/Desktop/bam/E4F.sam.bam","/Users/andersond/Desktop/bam/E5F.sam.bam"), annot.ext="/Users/andersond/Desktop/bam/merged.gtf", isGTFAnnotationFile=TRUE, useMetaFeatures=TRUE, allowMultiOverlap=TRUE, countMultiMappingReads=TRUE, isPairedEnd=TRUE, nthreads=4)\
\
#set groups\
groups=c("CM","CM","CM","CM","CM","EM","EM","EM","EM","EM","CF","CF","CF","CF","CF","EF","EF","EF","EF","EF")\
\
#count data by groups\
data.count<-DGEList(counts=data$counts, group=groups)\
\
#at least one group must have at least one read for every sample\
keep<-rowSums(cpm(data.count)>1)>=5\
data.filt<-data.count[keep,keep.lib.sizes=FALSE]\
\
#normalize data\
data.norm<-calcNormFactors(data.filt)\
\
#original grouping, treat each group as independent\
design <- model.matrix(~0+group, data=data.norm$samples)\
y<-estimateDisp(data.norm,design)\
colnames(design)\
##[1] "groupCF" "groupCM" "groupEF" "groupEM"\
\
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0
\cf0 #here is where I did pairwise comparisons\
\
#attempting with glm\
fit<-glmQLFit(y,design)\
\
#compare EM vs CM\
qlfcmvem<-glmQLFTest(fit,contrast=c(0,-1,0,1))\
\
#report top 10 DE genes\
topTags(qlfcmvem)\
##Coefficient:  -1*groupCM 1*groupEM \
##               logFC    logCPM        F       PValue        FDR\
##XLOC_001270  2.723237 1.0156503 35.90512 8.061996e-06 0.09983165\
##XLOC_020143  8.928699 9.6072255 34.02522 1.139241e-05 0.09983165\
##XLOC_016640 -2.127125 7.2241615 31.47795 1.858081e-05 0.10397763\
##XLOC_014459  6.793124 4.3138508 30.25157 2.373106e-05 0.10397763\
##XLOC_011710  2.175849 3.7254660 28.38446 3.486917e-05 0.10844442\
##XLOC_020613  8.870118 9.4767582 27.50744 4.200588e-05 0.10844442\
##XLOC_025229  5.687304 9.0665198 27.36469 4.331342e-05 0.10844442\
##XLOC_020916  2.202162 0.3658047 26.40424 5.337150e-05 0.11411547\
##XLOC_016492  1.164509 4.7650602 25.98103 5.860089e-05 0.11411547\
##XLOC_021505  4.478976 4.9933870 24.21705 8.739747e-05 0.15317281\
\
#none are significant using FDR\
\
#read in data table of all pairwise comparisons\
tab<-read.table("/Volumes/Seagate\\ Expansion\\ Drive/Band\\ Trascriptome/Code/datatable.txt")\
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0
\cf0 \
#find names to recall relevant info\
colnames(tab)\
## [1] "Annot_Name"   "Cuff_Name"    "Scaffold"     "Start"        "Stop"         "Length_ORF"   "Direction"    "Info"        \
## [9] "C1M"          "C2M"          "C3M"          "C5M"          "C6M"          "E1M"          "E3M"          "E4M"         \
##[17] "E5M"          "E6M"          "C1F"          "C2F"          "C3F"          "C4F"          "C5F"          "E1F"         \
##[25] "E2F"          "E3F"          "E4F"          "E5F"          "C1M.1"        "C2M.1"        "C3M.1"        "C5M.1"       \
##[33] "C6M.1"        "E1M.1"        "E3M.1"        "E4M.1"        "E5M.1"        "E6M.1"        "C1F.1"        "C2F.1"       \
##[41] "C3F.1"        "C4F.1"        "C5F.1"        "E1F.1"        "E2F.1"        "E3F.1"        "E4F.1"        "E5F.1"       \
##[49] "CMvEM_logFC"  "CMvEM_logCPM" "CMvEM_pval"   "CMvEM_FDR"    "CMvCF_logFC"  "CMvCF_logCPM" "CMvCF_pval"   "CMvCF_FDR"   \
##[57] "CMvEF_logFC"  "CMvEF_logCPM" "CMvEF_pval"   "CMvEF_FDR"    "CFvEF_logFC"  "CFvEF_logCPM" "CFvEF_pval"   "CFvEF_FDR"   \
##[65] "EMvCF_logFC"  "EMvCF_logCPM" "EMvCF_pval"   "EMvCF_FDR"    "EMvEF_logFC"  "EMvEF_logCPM" "EMvEF_pval"   "EMvEF_FDR"   \
\
#are these genes on my list of DE genes?\
tab[which(tab$Cuff_Name %in% row.names(topTags(qlfcmvem))),c(2,52,56,60,64,68,72)]\
##        Cuff_Name    CMvEM_FDR    CMvCF_FDR    CMvEF_FDR CFvEF_FDR  EMvCF_FDR    EMvEF_FDR\
##6443  XLOC_001270 9.965450e-05 7.413522e-07 2.499492e-09         1 0.30147373 0.8504383147\
##47589 XLOC_011710 5.401421e-04 1.279428e-04 3.544843e-06         1 0.70810054 0.9447918308\
##57994 XLOC_014459 1.891771e-05 2.068508e-07 2.175588e-06         1 0.92623713 0.7819480462\
##65808 XLOC_016492 4.565561e-03 9.584374e-01 2.237191e-01         1 0.05706193 0.0003345897\
##66432 XLOC_016640 1.870612e-04 8.457257e-02 1.122471e-02         1 0.18131737 0.0611732817\
##79953 XLOC_020143 5.624554e-06 7.161655e-07 6.386862e-07         1 0.83498403 0.8533919675\
##82166 XLOC_020613 1.527546e-04 6.894498e-05 2.502073e-05         1 0.93621137 0.7769950882\
##83861 XLOC_020916 4.565561e-03 8.866799e-05 3.639616e-05         1 0.77428597 0.8677217547\
##86256 XLOC_021505 6.546771e-04 5.274925e-03 6.495492e-04         1 0.63433027 0.3527051300\
##99905 XLOC_025229 1.527546e-04 2.028750e-04 1.629760e-04         1 0.57683258 0.6095726902\
\
#calling the same genes\
\
#use suggested interaction model\
#set levels\
expose=c("Control","Control","Control","Control","Control","Estrogen","Estrogen","Estrogen","Estrogen","Estrogen","Control","Control","Control","Control","Control","Estrogen","Estrogen","Estrogen","Estrogen","Estrogen")\
sex=c("Male","Male","Male","Male","Male","Male","Male","Male","Male","Male","Female","Female","Female","Female","Female","Female","Female","Female","Female","Female")\
\
#new groupings\
targets<-data.frame(sex,expose,groups)\
row.names(targets)<-row.names(y$samples)\
\
#relevel to control males\
targets$expose<-relevel(targets$expose, ref="Control")\
targets$sex<-relevel(targets$sex, ref="Male")\
\
#generate the different groups\
design2<-model.matrix(~sex*expose, data=targets)\
z<-estimateDisp(data.norm,design2)\
\
colnames(design2)\
##[1] "(Intercept)"              "sexFemale"                "exposeEstrogen"           "sexFemale:exposeEstrogen"\
\
#as before\
fit2<-glmQLFit(z,design2)\
\
#test interaction term\
qlfint<-glmQLFTest(fit2,coef=4)\
\
#top ten genes from test\
topTags(qlfint)\
##Coefficient:  sexFemale:exposeEstrogen \
##                logFC    logCPM        F       PValue        FDR\
##XLOC_026425 -7.323718 0.5846021 38.10081 5.464802e-06 0.09577612\
##XLOC_016492 -1.700219 4.7650602 28.04493 3.745967e-05 0.22509800\
##XLOC_001270 -3.194398 1.0156503 27.91202 3.853098e-05 0.22509800\
##XLOC_020143 -8.989275 9.6072255 25.69379 6.247171e-05 0.22840500\
##XLOC_023112 -1.830726 3.1476563 25.50551 6.516176e-05 0.22840500\
##XLOC_025041  3.219733 5.3532610 22.97283 1.170723e-04 0.31280496\
##XLOC_020613 -9.326912 9.4767582 22.19506 1.411996e-04 0.31280496\
##XLOC_016640  2.456785 7.2241615 22.14921 1.427844e-04 0.31280496\
##XLOC_011710 -2.511079 3.7254660 20.18780 2.331114e-04 0.44701874\
##XLOC_012280 -2.595675 0.2795221 19.83861 2.550603e-04 0.44701874\
\
#none are significant\
#compare to pairwise table\
tab[which(tab$Cuff_Name %in% row.names(topTags(qlfint))),c(2,52,56,60,64,68,72)]\
##         Cuff_Name    CMvEM_FDR    CMvCF_FDR    CMvEF_FDR    CFvEF_FDR  EMvCF_FDR    EMvEF_FDR\
##6443   XLOC_001270 9.965450e-05 7.413522e-07 2.499492e-09 1.000000e+00 0.30147373 8.504383e-01\
##47589  XLOC_011710 5.401421e-04 1.279428e-04 3.544843e-06 1.000000e+00 0.70810054 9.447918e-01\
##49719  XLOC_012280 2.994264e-01 7.201677e-01 7.986060e-03 1.000000e+00 0.80366428 1.413328e-01 <\'97\
##65808  XLOC_016492 4.565561e-03 9.584374e-01 2.237191e-01 1.000000e+00 0.05706193 3.345897e-04 <\'97\
##66432  XLOC_016640 1.870612e-04 8.457257e-02 1.122471e-02 1.000000e+00 0.18131737 6.117328e-02   \
##79953  XLOC_020143 5.624554e-06 7.161655e-07 6.386862e-07 1.000000e+00 0.83498403 8.533920e-01 \
##82166  XLOC_020613 1.527546e-04 6.894498e-05 2.502073e-05 1.000000e+00 0.93621137 7.769951e-01\
##92550  XLOC_023112 6.206236e-01 8.570532e-01 2.032607e-02 2.449811e-01 0.70863450 2.943900e-02  <\'97\
##99119  XLOC_025041 6.674701e-01 2.725815e-02 6.803904e-01 1.408522e-01 0.24351806 1.001008e-05  <\'97 \
##104045 XLOC_026425 1.000000e+00 8.799280e-07 3.392100e-01 1.100685e-08 0.46397634 1.924683e-07 <\'97\
\
#this was one of my concerns with plotting interaction term. <\'97 shows a change, but not from the specific direction we\'92re interested in. E.g. CM v EF or (EM v EF, CM v EM) are significant which are interactions of sex and exposure\
\
\
}